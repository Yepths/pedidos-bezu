<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yogurt & Helados BezÃº</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    :root {
      --color-acento: #ff6347;
      --color-principal: #333;
      --color-fondo-claro: #fffaf0;
      --color-sombra: rgba(0, 0, 0, 0.1);
      --color-borde: #ddd;
      --color-exito: #25D366; /* Verde WhatsApp */
    }

    body {
  margin: 0;
  font-family: 'Poppins', Arial, sans-serif;
  color: var(--color-principal);
  min-height: 100vh;
  position: relative; /* necesario para usar ::before */
}


/* Fondo con imagen + degradado */
body::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(rgba(0, 100, 255, 0.2), rgba(0, 150, 255, 0.5)), /* degradado azul */
    url("imgs/fondo.png") no-repeat center center fixed; /* imagen */
  background-size: cover;
  opacity: 0.5; /* ajusta la fuerza del fondo */
  z-index: -1;  /* lo manda al fondo */
}


    .container {
  width: 90%;
  max-width: 1200px;
  padding: 30px;
  background: rgba(255, 255, 255, 0.9); 
  border-radius: 20px;
  box-shadow: 0 10px 30px var(--color-sombra);
  margin: 40px auto; /* <-- centra horizontal */
}


    header {
  display: flex;
  flex-direction: column; /* apila logo y tÃ­tulo */
  align-items: center; /* centra horizontal */
  text-align: center;
  gap: 15px;
  margin-bottom: 30px;
  border-bottom: 2px solid var(--color-borde);
  padding-bottom: 20px;
}



  .slogan {
  font-family: 'Playball', cursive; /* puedes cambiar a otra fuente si quieres */
  font-size: 2.8rem;              /* tamaÃ±o mÃ¡s grande */
  color: #34a181;                 /* color destacado */
  margin-top: -50.5px;               /* espacio con el logo */
  font-weight: 600;               /* grosor ligero */
  text-shadow: 1px 1px 3px rgba(0,0,0,0.1); /* opcional para resaltar */
}


h1 {
  font-family: 'Lobster', cursive;
  color: var(--color-acento);
  font-size: 4.5rem; /* mÃ¡s grande */
  margin: 0;
  text-shadow: 2px 2px 6px rgba(0,0,0,0.2);
  transition: transform 0.3s ease;
}

h1:hover {
  transform: scale(1.05);
  color: #ff452b; /* efecto en hover */
}

.logo {
  width: 750px;   /* ancho del logo */
  height: auto;   /* mantiene la proporciÃ³n */
  margin-top: -80.5px;               /* espacio con el header */
  display: block;
}




    h2 {
      font-family: 'Playball', cursive;
      color: var(--color-acento);
      border-bottom: 1px dashed var(--color-borde);
      padding-bottom: 10px;
      margin-top: 0;
    }

    /* Productos */
    .productos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }

    .producto {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 12px var(--color-sombra);
      transition: transform 0.3s;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      min-height: 420px; /* igual altura */
    }

    .producto:hover {
      transform: translateY(-8px) scale(1.02);
    }

    .producto img {
      width: 100%;
      max-width: 200px;
      height: 180px; /* fuerza altura uniforme */
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    /* Extras */
    .extras {
      margin: 10px 0;
      text-align: left;
      font-size: 0.9rem;
      width: 100%;
    }

    .extras label {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      cursor: pointer;
    }

    .extras input[type="checkbox"] {
      display: none;
    }

    .extras input[type="checkbox"] + span {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid var(--color-acento);
      border-radius: 4px;
      margin-right: 8px;
      position: relative;
    }

    .extras input[type="checkbox"]:checked + span::before {
      content: 'âœ”';
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      background-color: var(--color-acento);
      color: white;
      font-size: 14px;
    }

    /* Botones */
    button {
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
    }

    .agregar {
      background: var(--color-acento);
      color: white;
    }

    .eliminar {
      background: #e74c3c;
      color: white;
      font-size: 0.9rem;
      padding: 5px 10px;
      width: auto;
    }

    /* Carrito */
    #carrito {
      margin-top: 40px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      box-shadow: 0 6px 12px var(--color-sombra);
    }

    #lista-carrito li {
      list-style: none;
      padding: 10px 0;
      border-bottom: 1px dotted var(--color-borde);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #finalizar {
      margin-top: 20px;
      background: #25D366;
      color: white;
      padding: 12px 20px;
      width: auto;
      display: block;
      margin: 20px auto 0;
    }/* Formulario de Pedido */
     .input-data {
     max-width: 400px;
     margin: 20px auto;
     padding: 20px;
     background: #f9f9f9;
     border-radius: 10px; 
     box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
     .input-data label, .input-data input {
     display: block;
     width: 100%;
     margin-bottom: 10px;
     }
     .input-data input {
     padding: 10px;
     border: 1px solid #ccc;
     border-radius: 5px;
     box-sizing: border-box;
    }

  #finalizar { 
     margin-top: 20px; 
     background: var(--color-exito); 
     color: white; 
     padding: 12px 20px; 
     width: 100%; 
     display: block; 
     margin: 20px auto 0; 
     font-size: 1.1rem; 
    }
     #registro-status {
     text-align: center;
     margin-top: 10px;
     font-weight: 600;
   }
    
  </style>
</head>
<body>
  <div class="container">
    <header>
  <h1>Yogurt Artesanal</h1>
  <img src="imgs/logo.gif" alt="Logo Yogurt & Helados" class="logo">
  <p class="slogan">Sabor y salud</p>
</header>


    <!-- Productos -->
    <div id="productos" class="productos"></div>

     <!-- Carrito / Formulario de Pedido Ãšnico -->

    <div id="carrito">
    <h2><i class="fas fa-shopping-cart"></i> Carrito de Pedido</h2>
    <ul id="lista-carrito"></ul>
    <p><strong>Total: S/ <span id="total">0.00</span></strong></p>
    <p id="pedido-vacio" style="text-align:center; color:#e74c3c; font-weight:600;">AÃ±ade productos para continuar.</p>
    
    

    
    <!-- Formulario de datos de cliente para el pedido -->
    <div class="input-data">
    <label for="nombre_pedido">Tu Nombre o Alias:</label>
    <input type="text" id="nombre_pedido" placeholder="Ej: Jimmy" required>
 
    <label for="telefono_pedido">NÃºmero de celular:</label>
    <input type="tel" id="telefono_pedido" placeholder="9** *** ***" required>
 
    <label for="direccion_pedido">DirecciÃ³n de Entrega:</label>
    <input type="text" id="direccion_pedido" placeholder="Ej: Av. Los Girasoles 123" required>
  </div>
 
    <button id="finalizar" onclick="enviarPedido()"><i class="fab fa-whatsapp"></i> Procesar y Enviar Pedido</button>
    <p id="registro-status" style="display:none;"></p>  
  </div>

<script>
    
    // 
    const GAS_URL_PEDIDO = 'https://script.google.com/macros/s/AKfycbzW6TmM1jiRPMp6437p9xXWZYeo5krV9Lx8krxtm0rs11HjOgOirstlPpgrpXpfpXwx7w/exec';
    
    let carrito = [];
    let total = 0;
  
    // Variables de color para JS
    const rootStyles = getComputedStyle(document.documentElement);
    const COLOR_EXITO = rootStyles.getPropertyValue('--color-exito').trim();
    const COLOR_PRINCIPAL = rootStyles.getPropertyValue('--color-principal').trim();
    const COLOR_ACENTO = rootStyles.getPropertyValue('--color-acento').trim();

    
    // Lista de productos integrada
    const productos = [
      { "nombre": "Fresa", "precio": 10, "imagen": "imgs/fresa.jpg" },
      { "nombre": "Guanabana", "precio": 10, "imagen": "imgs/guanabana.jpg" },
      { "nombre": "PiÃ±a", "precio": 10, "imagen": "imgs/piÃ±a.jpg" },
      { "nombre": "Durazno", "precio": 10, "imagen": "imgs/durazno.jpg" },
      { "nombre": "LÃºcuma", "precio": 10, "imagen": "imgs/lucma.jpg" },
      { "nombre": "Vainilla", "precio": 10, "imagen": "imgs/vainilla.jpg" },
      { "nombre": "Natural", "precio": 9.5, "imagen": "imgs/natural.jpg" }, 
      { "nombre": "ArÃ¡ndano", "precio": 12, "imagen": "imgs/arandanos.jpg" }
    ];

    function cargarProductos() {
      const contenedor = document.getElementById("productos");
      productos.forEach((prod, index) => {
        const div = document.createElement("div");
        div.classList.add("producto");
        div.innerHTML = `
          <img src="${prod.imagen}" alt="${prod.nombre}">
          <h3>${prod.nombre}</h3>
          <p>S/ ${prod.precio}</p>
          <div class="extras">
            <label><input type="checkbox" value="ChÃ­a"><span></span> + ChÃ­a (+S/1)</label>
            <label><input type="checkbox" value="Linaza"><span></span> + Linaza (+S/1)</label>
            <label><input type="checkbox" value="Cereal"><span></span> + Cereal (+S/2)</label>
          </div>
          <button class="agregar" onclick="agregarCarrito(${index}, this)"><i class="fas fa-plus-circle"></i> AÃ±adir</button>
        `;
        contenedor.appendChild(div);
      });
    }

    // *** FUNCIÃ“N MODIFICADA: Agrupa productos idÃ©nticos ***
    function agregarCarrito(index, btn) {
      const producto = productos[index];
      const card = btn.parentElement;

      let extras = [];
      let extraPrecio = 0;

      card.querySelectorAll("input[type=checkbox]").forEach(chk => {
        if (chk.checked) {
          extras.push(chk.value);
          extraPrecio += (chk.value === "Cereal" ? 2 : 1);
          // Desmarcar para el siguiente uso
          chk.checked = false; 
        }
      });

      const precioUnitario = parseFloat((producto.precio + extraPrecio).toFixed(2));
      
      // Crea una 'clave' Ãºnica para el producto + extras
      const clave = producto.nombre + (extras.length > 0 ? "_" + extras.sort().join("_") : "");

      // Busca si el item ya existe en el carrito
      const itemExistente = carrito.find(item => item.clave === clave);

      if (itemExistente) {
        // Si existe, solo incrementa la cantidad
        itemExistente.cantidad++;
        itemExistente.precio = parseFloat((itemExistente.cantidad * precioUnitario).toFixed(2)); // Actualiza el total del grupo
      } else {
        // Si no existe, aÃ±ade un nuevo item
        const item = {
          clave: clave, // La clave Ãºnica para agrupar
          nombre: producto.nombre,
          precioUnitario: precioUnitario, // Precio de UNA unidad
          precio: precioUnitario, // Precio inicial (1 unidad)
          extras: extras,
          cantidad: 1
        };
        carrito.push(item);
      }

      total = parseFloat((total + precioUnitario).toFixed(2));
      actualizarCarrito();
    }

    // *** FUNCIÃ“N MODIFICADA: Muestra cantidad en el listado ***
    function actualizarCarrito() {
      const lista = document.getElementById("lista-carrito");
      lista.innerHTML = "";
      
      if (carrito.length === 0) {
        document.getElementById('pedido-vacio').style.display = 'block';
        document.getElementById('finalizar').disabled = true;
      } else {
        document.getElementById('pedido-vacio').style.display = 'none';
        document.getElementById('finalizar').disabled = false;
      }
      
      // Recalcula el total a partir de los items agrupados para asegurar coherencia
      total = carrito.reduce((sum, item) => sum + item.precio, 0);

      carrito.forEach((item, i) => {
        const li = document.createElement("li");
        
        let detalleProducto = `*${item.cantidad} x ${item.nombre}`;
        if (item.extras.length > 0) {
          detalleProducto += ` (+${item.extras.join(", ")})`;
        }

        li.innerHTML = `
          <span>
            <strong>${detalleProducto}</strong>
            <small>(S/${item.precioUnitario.toFixed(2)} c/u)</small>
          </span>
          <span>
            S/ ${item.precio.toFixed(2)}
            <button class="eliminar" onclick="eliminarItem(${i})" title="Eliminar"><i class="fas fa-trash-alt"></i></button>
          </span> 
        `;
        lista.appendChild(li);
      });
      
      document.getElementById("total").textContent = total.toFixed(2);
    }

    // *** FUNCIÃ“N MODIFICADA: Elimina por completo el grupo de productos. ***
    function eliminarItem(index) {
        // Al eliminar, restamos el total del grupo completo
        total = parseFloat((total - carrito[index].precio).toFixed(2)); 
        carrito.splice(index, 1);
        actualizarCarrito();
    }

     /**
Â  Â  Â * FunciÃ³n que REGISTRA de forma ASÃNCRONA y abre WhatsApp INMEDIATAMENTE.
Â  Â  Â */
Â  Â  function enviarPedido() {
Â  Â  Â  const btn = document.getElementById("finalizar");
Â  Â  Â  const statusDiv = document.getElementById('registro-status');
Â  Â  Â  const originalText = btn.innerHTML;
Â  Â  Â Â 
Â  Â  Â  // --- 1. VALIDACIÃ“N INICIAL ---
Â  Â  Â  if (carrito.length === 0) {
Â  Â  Â  Â  statusDiv.style.display = 'block';
Â  Â  Â  Â  statusDiv.textContent = 'Â¡El carrito estÃ¡ vacÃ­o!';
Â  Â  Â  Â  statusDiv.style.color = COLOR_ACENTO;
Â  Â  Â  Â  setTimeout(() => statusDiv.style.display = 'none', 3000);
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const nombre = document.getElementById('nombre_pedido').value.trim();
Â  Â  Â  const telefono = document.getElementById('telefono_pedido').value.trim();
Â  Â  Â  const direccion = document.getElementById('direccion_pedido').value.trim();
Â  Â  Â  const pedidoDetallado = generarTextoPedido();
Â  Â  Â  const totalPedido = total.toFixed(2);

Â  Â  Â  if (!nombre || !telefono || !direccion) {
Â  Â  Â  Â  statusDiv.style.display = 'block';
Â  Â  Â  Â  statusDiv.textContent = 'âš ï¸ Completa tus datos de contacto.';
Â  Â  Â  Â  statusDiv.style.color = '#e74c3c';
Â  Â  Â  Â  setTimeout(() => statusDiv.style.display = 'none', 3000);
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // --- 2. PREPARACIÃ“N E INDICADOR DE PROCESO ---
Â  Â  Â  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
Â  Â  Â  btn.disabled = true;

Â  Â  Â  // Mostramos el mensaje UNIFICADO de Ã©xito de UX (Enfocando en WhatsApp)
Â  Â  Â  statusDiv.style.display = 'block';
Â  Â  Â  statusDiv.textContent = 'Â¡Gracias! Tu solicitud ha sido recibida. Revisa tu WhatsApp.';
Â  Â  Â  statusDiv.style.color = COLOR_EXITO; // Verde de Ã©xito

Â  Â  Â  // --- 3. ENVÃO INDEPENDIENTE A GOOGLE SHEETS (NO BLOQUEANTE) ---
Â  Â  Â  const dataSheets = {
Â  Â  Â  Â  nombre: nombre,Â 
Â  Â  Â  Â  pedido: pedidoDetallado,
Â  Â  Â  Â  total: totalPedido,
Â  Â  Â  Â  direccion: direccion,
Â  Â  Â  Â  telefono: telefono
Â  Â  Â  };

Â  Â  Â  if (GAS_URL_PEDIDO.length === 0) {Â 
Â  Â  Â  Â  console.error("Error: Falta configurar la variable GAS_URL_PEDIDO. Solo se enviarÃ¡ por WhatsApp.");
Â  Â  Â  } else {
Â  Â  Â  Â  // Ejecutar fetch sin 'await' para que corra en segundo plano
Â  Â  Â  Â  fetch(GAS_URL_PEDIDO, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  mode: 'cors',
Â  Â  Â  Â  Â  Â  body: JSON.stringify(dataSheets)
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  .then(result => {
Â  Â  Â  Â  Â  Â  // Registro exitoso (solo para log interno)
Â  Â  Â  Â  Â  Â  console.log('âœ… Registro en Sheets OK:', result);
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  // Error de red o GAS (solo para log interno)
Â  Â  Â  Â  Â  Â  console.error('âŒ Error de red o GAS al guardar. WhatsApp se enviÃ³ de todas formas.', error);
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // --- 4. ABRIR WHATSAPP INMEDIATAMENTE (Flujo principal de UX) ---
Â  Â  Â  const mensajeWhatsApp = generarMensajeWhatsApp(nombre, telefono, direccion, totalPedido);
Â  Â  Â Â 
Â  Â  Â  const numero = "51935643297"; // Â¡CAMBIA ESTE NÃšMERO POR EL TUYO!
Â  Â  Â  const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensajeWhatsApp)}`;
Â  Â  Â Â 
Â  Â  Â  // Breve pausa visual antes de abrir
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  window.open(url, "_blank");
Â  Â  Â  Â  // Limpiar interfaz despuÃ©s de abrir WhatsApp
Â  Â  Â  Â  limpiarPedido();
Â  Â  Â  }, 1500); // Damos 1.5s para que el usuario lea el mensaje de Ã©xito

Â  Â  Â  // --- 5. Restablecer el botÃ³n ---
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  statusDiv.style.display = 'none';
Â  Â  Â  Â  btn.innerHTML = originalText;
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  }, 5000);
Â  Â  }

Â  Â  // *** FUNCIÃ“N MODIFICADA ***
Â  Â  function generarTextoPedido() {
Â  Â  Â  // Cada producto se une con un salto de lÃ­nea para mejor visualizaciÃ³n en Sheets
Â  Â  Â  return carrito.map(item => {
Â  Â  Â  Â  let detalle = `- ${item.cantidad}x${item.nombre}`; // AÃ±adir guion para lista
Â  Â  Â  Â  if (item.extras.length > 0) {
Â  Â  Â  Â  Â  detalle += ` (+${item.extras.join(", ")})`;
Â  Â  Â  Â  }
Â  Â  Â  Â  detalle += ` [S/${item.precio.toFixed(2)}]`;
Â  Â  Â  Â  return detalle;
Â  Â  Â  }).join('\n'); // <-- CAMBIO CLAVE: Usa '\n' (salto de lÃ­nea) en lugar de ' | '
Â  Â  }

Â  Â  function generarMensajeWhatsApp(nombre, telefono, direccion, totalPedido) {
Â  Â  Â  let mensaje = `Â¡Hola! Quisiera realizar mi pedido.\n\nMi nombre es *${nombre}* y este es el detalle:\n\n*ğŸ“ Detalle del Pedido:*\n`;
      const emojiItem = 'â¤';
Â  Â  Â Â 
Â  Â  Â  carrito.forEach(item => {
Â  Â  Â  Â  mensaje += `${emojiItem} *${item.cantidad}x* ${item.nombre}${item.extras.length > 0 ? " (+" + item.extras.join(", ") + ")" : ""} - S/ ${item.precio.toFixed(2)}\n`;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  mensaje += `\n*TOTAL: S/ ${totalPedido}*\n\n`;
Â  Â  Â  mensaje += `*Datos para el Delivery:*\nğŸ“ TelÃ©fono: ${telefono}\nğŸ“ DirecciÃ³n: ${direccion}`;
Â  Â  Â  return mensaje;
Â  Â  }

Â  Â  function limpiarPedido() {
Â  Â  Â  carrito = [];
Â  Â  Â  total = 0;
Â  Â  Â  actualizarCarrito();
Â  Â  Â  document.getElementById('nombre_pedido').value = '';
Â  Â  Â  document.getElementById('telefono_pedido').value = '';
Â  Â  Â  document.getElementById('direccion_pedido').value = '';
Â  Â  Â  // Dejamos el statusDiv para que el cliente lea el mensaje de Ã©xito unificado por un tiempo
Â  Â  }
Â  Â  cargarProductos();
Â  Â Â 

Â  </script>
</body>
</html>

